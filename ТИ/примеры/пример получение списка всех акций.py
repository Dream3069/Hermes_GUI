from tinkoff.invest import RequestError, Client
from tinkoff.invest.services import InstrumentsService
import numpy as np
from datetime import datetime, timedelta, timezone
from pandas import DataFrame
from tinkoff.invest import Client, RequestError, CandleInterval, HistoricCandle, InstrumentIdType

import creds
import pandas as pd
lst = [['BBG000BLYWX6', 0.6746361645864837], ['BBG00G2HHYD7', 0.29702617624216143], ['BBG000BFWF13', 0.2996740635813419], ['BBG000FWGSZ5', 0.7892899073057076], ['BBG004S68CV8', 0.3720460748737292], ['BBG000Q7ZZY2', 0.8384744242914909], ['BBG000BM6788', 0.24746673658808313], ['BBG000RJL816', 0.6083945883011341], ['BBG004RVFCY3', 0.2689741055688569], ['BBG002GHV6L9', 0.6351623942305819], ['BBG000FQRVM3', 0.29699102006483086], ['BBG001M2SC01', 0.3837722997709564], ['BBG0029SG1C1', 0.4069820590648894], ['TCS00A105EX7', 0.32793192371139096], ['BBG000BQQH30', 0.210932790287108], ['BBG004S689R0', 0.18663099937565486], ['TCS2207L1061', 0.4333887961063459], ['BBG000SK7JS5', 0.4883464817801137], ['BBG002458LF8', 0.3967485182951091], ['BBG004S68829', 0.2149553132147617], ['TCS00A0JNXF9', 0.6211768695011542], ['BBG001MKZGY7', 0.5595858515015905], ['BBG000BX24N8', 0.3133901627089531], ['BBG004S68507', 0.23691639664159075], ['TCS00A105NV2', 0.2956820497251048], ['BBG008F2T3T2', 0.24710282842497586], ['BBG00BGKYH17', 0.7804474152460853], ['BBG000C1DF05', 0.27818265062936315], ['BBG005XR47P5', 0.3615884814237678], ['BBG000BD8ZK0', 0.32026589948173784], ['BBG000BG4202', 0.21321972521280433], ['BBG000PYX812', 0.44516891835440625], ['BBG004S686N0', 0.29162482901013836], ['BBG001LFLZZ1', 0.215871778633796], ['BBG00172J7S9', 0.37652054949551306], ['BBG004S68B31', 0.24383729473035376], ['BBG000VG1034', 0.3401690797315587], ['BBG000CKGDS5', 0.22004129101600406], ['BBG000R04X57', 0.2890374607654409], ['BBG01282ZHB3', 0.4559467888223394], ['BBG004RVFFC0', 0.21693604950373785], ['TCS10A0JNAB6', 0.3877518877632218], ['BBG008HD3V85', 1.1821034235026109], ['BBG000V07CB8', 0.718048767981387], ['BBG004S682Z6', 0.29939646557022737], ['BBG004S681W1', 0.18139581451772185], ['BBG000RG4ZQ4', 0.7186142776486346], ['BBG00475JZZ6', 0.3493209015704836], ['BBG000MZL0Y6', 0.5959172413955859], ['BBG000DR5QP5', 0.24919633089914955], ['BBG004S687G6', 0.3323345815828862], ['BBG004S68473', 0.19756647238240552], ['BBG000BN5LG7', 0.2892289075536469], ['BBG002BCQK67', 0.8497494168036875], ['BBG000RTHVK7', 0.3576439074337026], ['BBG004S681M2', 0.27297231268524186], ['BBG00LBLBBJ7', 0.6947144354956792], ['BBG00475KKY8', 0.22643994965554337], ['BBG000D7HF89', 0.19335699380593876], ['BBG002YFXL29', 0.39005499263089033], ['BBG000GQSRR5', 0.30905103815345014], ['BBG000W325F7', 0.33897754561331195], ['BBG000BX7DH0', 0.741565909206324], ['BBG004730JJ5', 0.254922516809739], ['BBG004Z2RGW8', 0.640398505157346], ['BBG00Y91R9T3', 0.373391401549968], ['BBG000RK52V1', 0.2741075292373172], ['BBG00DW3SZS1', 0.5405430317483324], ['BBG000VFX6Y4', 0.3884671390410565], ['BBG002B9T6Y1', 0.4626168930981415], ['BBG0047315D0', 0.30458379473741604], ['BBG009GSYN76', 0.2409605180243581], ['BBG000RJWGC4', 0.4405115764670925], ['BBG000Q7GJ60', 0.6375106960344372], ['BBG002W2FT69', 0.33962553748371055], ['BBG000BBL8V7', 0.2894837655509073], ['BBG004S68BH6', 0.3006444625608413], ['BBG004731354', 0.22335605893313093], ['BBG004TC84Z8', 0.38091438247641773], ['BBG00JM7QBR6', 0.39502869340591945], ['BBG000VKG4R5', 0.45883488945998335], ['BBG000BT1715', 0.22037303899783636], ['BBG000BTGKK9', 0.35430261432068855], ['BBG002B2J5X0', 0.23402524805378586], ['BBG00475K6C3', 0.3043900194169871], ['BBG000RMWQD4', 0.29709556860029174], ['BBG000GQSVC2', 0.2330711107298817], ['BBG000BKTFN2', 0.24844450834803686], ['BBG000BQPC32', 0.31997363429617065], ['BBG000PKWCQ7', 0.5140792132521678], ['BBG010MW0N84', 0.5609292626665232], ['BBG004S68C39', 0.39557603972460503], ['BBG000BBV4M5', 0.5415422730374748], ['BBG009T22D49', 0.3998507451401833], ['BBG004S68JR8', 0.6033445463014785], ['BBG004S685M3', 0.26312726749124016], ['BBG000D8KTN6', 0.2348302300355124], ['BBG005PG80K4', 0.3885523855798091], ['BBG000LNHHJ9', 0.3529612066246159], ['BBG0029SFXB3', 0.3171996750464741], ['BBG00ZHCX1X2', 0.34127452666377717], ['BBG000PZ0833', 0.3809482432673917], ['BBG000F6YPH8', 0.3839850776392017], ['BBG007N0Z367', 0.39612751807732594], ['BBG00R4Z2NT4', 0.4808279543299374], ['BBG000VQWH86', 0.5409323024805971], ['BBG002WLDMW5', 0.4049250198811353], ['BBG000BV4XJ1', 0.2450081049642855], ['TCS000BN56Q9', 0.3904644687015045], ['BBG005BT60Y8', 0.26226547199738465], ['BBG000GQ7K93', 0.24850314691113892], ['TCS4346Y1038', 0.3893223333536654], ['BBG00F6NKQX3', 0.24748782481848947], ['BBG004S68758', 0.30548451305838326], ['BBG004S683W7', 0.2860043996731826], ['BBG012YQ6P43', 0.41213472668392914], ['BBG001BBGNS2', 1.004953376572558], ['BBG004730N88', 0.18777347354241888], ['BBG001DJNR51', 0.8321877926275119], ['TCS00A105BN4', 0.6218420946779809], ['BBG00HY6V6H5', 1.3087184451967677], ['BBG004S68CP5', 0.34524105133319255], ['BBG000GMGNB3', 0.25163839647367114], ['BBG010JBYV98', 0.394801843820373], ['BBG000MZL2S9', 0.567345238002945], ['BBG004S68DD6', 0.5092197963269613], ['BBG004S68598', 0.3887155023171196], ['BBG004S688G4', 0.13099559279519604], ['BBG004730RP0', 0.21241899304786932], ['BBG0047315Y7', 0.18160362428627952], ['BBG0063FKTD9', 0.3634822724682316], ['BBG000QJW156', 0.42656447692010235], ['BBG000FVXD63', 0.3091274075563092], ['BBG000LWNRP3', 0.7429491046123026], ['BBG000NLC9Z6', 0.5110984597483694], ['BBG00QKJSX05', 0.3277955015138499], ['BBG000VH7TZ8', 0.3509504565206677], ['TCS00A103X66', 0.28715136290632043], ['BBG000NLB2G3', 0.6149436921817565], ['BBG002B9MYC1', 0.4657238176054815], ['BBG004S684M6', 0.2526110394118978], ['BBG002B298N6', 0.44769456415394243], ['BBG000Q7GG57', 0.8224804933891446], ['BBG000DBD6F6', 0.7445023267028728], ['BBG000RP8V70', 0.6478127437297219], ['BBG00F9XX7H4', 0.46071267320818055], ['BBG000TJ6F42', 0.707468016650335], ['BBG000K3STR7', 0.42117137946912264], ['BBG000DD3510', 0.2771539308180033], ['BBG005D1WCQ1', 0.7447051473208933], ['BBG00475K2X9', 0.282011667678702], ['BBG004S681B4', 0.3110680394207341], ['BBG000TY1CD1', 0.24373873200783872], ['BBG000SR0YS4', 0.40858083374870874], ['BBG00CVQZQ96', 0.22454636728453595], ['BBG003LYCMB1', 0.650018042653199], ['BBG000QF1Q17', 0.5159670132826827], ['BBG000BGX2S0', 0.1557908764651936], ['BBG004S68696', 0.3224103880240563], ['BBG0100R9963', 0.33889694886834487], ['BBG000NLCCM3', 0.23419070241381942], ['BBG000N7KBZ3', 0.6731716871518428], ['TCS00A0JR514', 0.4283303865172949], ['BBG000BFVZ83', 0.2620026597308728], ['BBG000BNC3Y9', 0.3482603316600783], ['BBG004S686W0', 0.33167934522632614], ['BBG000VJMH65', 0.7952242998730169], ['BBG004S687W8', 0.30856133912799316], ['BBG004S68614', 0.30849804061956015], ['BBG000R607Y3', 0.25401473613507075], ['BBG004731032', 0.21436608597698037], ['BBG000BTNGZ4', 0.4716669636239801], ['BBG00WCNDCZ6', 0.6332706273348223], ['BBG000CZWZ05', 0.2766757035367557], ['BBG004S68BR5', 0.5380619395730908], ['BBG000QFH687', 0.3888234269014223], ['BBG0027F0Y27', 0.44105499826963934], ['BBG004S68FR6', 0.417774067524629], ['BBG000C7P5M7', 0.7560526500696412], ['BBG00209SZJ7', 0.7296845338368696], ['BBG00XDH4NZ2', 0.7150816450426511]]

pd.set_option('display.max_rows', 500)
pd.set_option('display.max_columns', 500)
pd.set_option('display.width', 1000)
figi = 'BBG004S689R0'
try:
    with Client(creds.TOKEN) as client:
        for i in lst:
            # Получение списка акций
            stocks = client.instruments.share_by(id_type=InstrumentIdType.INSTRUMENT_ID_TYPE_FIGI, id=i[0])
            i.append(stocks.instrument.ticker)
        print(lst)

except RequestError as e:
    print(str(e))

# [['BBG000BLYWX6', 0.6746361645864837, 'BCRX'], ['BBG00G2HHYD7', 0.29702617624216143, 'AVTR'], ['BBG000BFWF13', 0.2996740635813419, 'PZZA'], ['BBG000FWGSZ5', 0.7892899073057076, 'IRKT'], ['BBG004S68CV8', 0.3720460748737292, 'VSMO'], ['BBG000Q7ZZY2', 0.8384744242914909, 'UNAC'], ['BBG000BM6788', 0.24746673658808313, 'TT'], ['BBG000RJL816', 0.6083945883011341, 'TTLK'], ['BBG004RVFCY3', 0.2689741055688569, 'MGNT'], ['BBG002GHV6L9', 0.6351623942305819, 'SPBE'], ['BBG000FQRVM3', 0.29699102006483086, 'WAT'], ['BBG001M2SC01', 0.3837722997709564, 'ETLN'], ['BBG0029SG1C1', 0.4069820590648894, 'KZOSP'], ['TCS00A105EX7', 0.32793192371139096, 'WUSH'], ['BBG000BQQH30', 0.210932790287108, 'COP'], ['BBG004S689R0', 0.18663099937565486, 'PHOR'], ['TCS2207L1061', 0.4333887961063459, 'HHRU'], ['BBG000SK7JS5', 0.4883464817801137, 'LNZL'], ['BBG002458LF8', 0.3967485182951091, 'SELG'], ['BBG004S68829', 0.2149553132147617, 'TATNP'], ['TCS00A0JNXF9', 0.6211768695011542, 'PRFN'], ['BBG001MKZGY7', 0.5595858515015905, 'YEXT'], ['BBG000BX24N8', 0.3133901627089531, 'WST'], ['BBG004S68507', 0.23691639664159075, 'MAGN'], ['TCS00A105NV2', 0.2956820497251048, 'CARM'], ['BBG008F2T3T2', 0.24710282842497586, 'RUAL'], ['BBG00BGKYH17', 0.7804474152460853, 'NKHP'], ['BBG000C1DF05', 0.27818265062936315, 'RBA'], ['BBG005XR47P5', 0.3615884814237678, 'CTLT'], ['BBG000BD8ZK0', 0.32026589948173784, 'TSM'], ['BBG000BG4202', 0.21321972521280433, 'CPB'], ['BBG000PYX812', 0.44516891835440625, 'ZUMZ'], ['BBG004S686N0', 0.29162482901013836, 'BANEP'], ['BBG001LFLZZ1', 0.215871778633796, 'BRX'], ['BBG00172J7S9', 0.37652054949551306, 'OKEY'], ['BBG004S68B31', 0.24383729473035376, 'ALRS'], ['BBG000VG1034', 0.3401690797315587, 'MRKP'], ['BBG000CKGDS5', 0.22004129101600406, 'FR'], ['BBG000R04X57', 0.2890374607654409, 'FLOT'], ['BBG01282ZHB3', 0.4559467888223394, 'BROS'], ['BBG004RVFFC0', 0.21693604950373785, 'TATN'], ['TCS10A0JNAB6', 0.3877518877632218, 'ABIO'], ['BBG008HD3V85', 1.1821034235026109, 'UWGN'], ['BBG000V07CB8', 0.718048767981387, 'DVEC'], ['BBG004S682Z6', 0.29939646557022737, 'RTKM'], ['BBG004S681W1', 0.18139581451772185, 'MTSS'], ['BBG000RG4ZQ4', 0.7186142776486346, 'TGKN'], ['BBG00475JZZ6', 0.3493209015704836, 'FEES'], ['BBG000MZL0Y6', 0.5959172413955859, 'PMSB'], ['BBG000DR5QP5', 0.24919633089914955, 'BCO'], ['BBG004S687G6', 0.3323345815828862, 'MSRS'], ['BBG004S68473', 0.19756647238240552, 'IRAO'], ['BBG000BN5LG7', 0.2892289075536469, 'VALE'], ['BBG002BCQK67', 0.8497494168036875, 'NSVZ'], ['BBG000RTHVK7', 0.3576439074337026, 'GCHE'], ['BBG004S681M2', 0.27297231268524186, 'SNGSP'], ['BBG00LBLBBJ7', 0.6947144354956792, 'DAVA'], ['BBG00475KKY8', 0.22643994965554337, 'NVTK'], ['BBG000D7HF89', 0.19335699380593876, 'SON'], ['BBG002YFXL29', 0.39005499263089033, 'UNKL'], ['BBG000GQSRR5', 0.30905103815345014, 'NKNC'], ['BBG000W325F7', 0.33897754561331195, 'AQUA'], ['BBG000BX7DH0', 0.741565909206324, 'VRSB'], ['BBG004730JJ5', 0.254922516809739, 'MOEX'], ['BBG004Z2RGW8', 0.640398505157346, 'ROLO'], ['BBG00Y91R9T3', 0.373391401549968, 'OZON'], ['BBG000RK52V1', 0.2741075292373172, 'OGKB'], ['BBG00DW3SZS1', 0.5405430317483324, 'DELL'], ['BBG000VFX6Y4', 0.3884671390410565, 'GLTR'], ['BBG002B9T6Y1', 0.4626168930981415, 'KAZTP'], ['BBG0047315D0', 0.30458379473741604, 'SNGS'], ['BBG009GSYN76', 0.2409605180243581, 'CBOM'], ['BBG000RJWGC4', 0.4405115764670925, 'AMEZ'], ['BBG000Q7GJ60', 0.6375106960344372, 'TGKBP'], ['BBG002W2FT69', 0.33962553748371055, 'ABRD'], ['BBG000BBL8V7', 0.2894837655509073, 'PWR'], ['BBG004S68BH6', 0.3006444625608413, 'PIKK'], ['BBG004731354', 0.22335605893313093, 'ROSN'], ['BBG004TC84Z8', 0.38091438247641773, 'TRMK'], ['BBG00JM7QBR6', 0.39502869340591945, 'PAGS'], ['BBG000VKG4R5', 0.45883488945998335, 'MRKU'], ['BBG000BT1715', 0.22037303899783636, 'SJM'], ['BBG000BTGKK9', 0.35430261432068855, 'TREX'], ['BBG002B2J5X0', 0.23402524805378586, 'KRKNP'], ['BBG00475K6C3', 0.3043900194169871, 'CHMF'], ['BBG000RMWQD4', 0.29709556860029174, 'ENPG'], ['BBG000GQSVC2', 0.2330711107298817, 'NKNCP'], ['BBG000BKTFN2', 0.24844450834803686, 'HAL'], ['BBG000BQPC32', 0.31997363429617065, 'F'], ['BBG000PKWCQ7', 0.5140792132521678, 'MRKV'], ['BBG010MW0N84', 0.5609292626665232, 'PAY'], ['BBG004S68C39', 0.39557603972460503, 'LSRG'], ['BBG000BBV4M5', 0.5415422730374748, 'CNTL'], ['BBG009T22D49', 0.3998507451401833, 'SITE'], ['BBG004S68JR8', 0.6033445463014785, 'SVAV'], ['BBG004S685M3', 0.26312726749124016, 'RTKMP'], ['BBG000D8KTN6', 0.2348302300355124, 'CWT'], ['BBG005PG80K4', 0.3885523855798091, 'VVX'], ['BBG000LNHHJ9', 0.3529612066246159, 'KMAZ'], ['BBG0029SFXB3', 0.3171996750464741, 'KZOS'], ['BBG00ZHCX1X2', 0.34127452666377717, 'FIXP'], ['BBG000PZ0833', 0.3809482432673917, 'MGTSP'], ['BBG000F6YPH8', 0.3839850776392017, 'ELFV'], ['BBG007N0Z367', 0.39612751807732594, 'AGRO'], ['BBG00R4Z2NT4', 0.4808279543299374, 'VEON-RX'], ['BBG000VQWH86', 0.5409323024805971, 'BLNG'], ['BBG002WLDMW5', 0.4049250198811353, 'COUR'], ['BBG000BV4XJ1', 0.2450081049642855, 'UTHR'], ['TCS000BN56Q9', 0.3904644687015045, 'DSKY'], ['BBG005BT60Y8', 0.26226547199738465, 'NVEE'], ['BBG000GQ7K93', 0.24850314691113892, 'GPK'], ['TCS4346Y1038', 0.3893223333536654, 'PRO'], ['BBG00F6NKQX3', 0.24748782481848947, 'SMLT'], ['BBG004S68758', 0.30548451305838326, 'BANE'], ['BBG004S683W7', 0.2860043996731826, 'AFLT'], ['BBG012YQ6P43', 0.41213472668392914, 'CIAN'], ['BBG001BBGNS2', 1.004953376572558, 'ORUP'], ['BBG004730N88', 0.18777347354241888, 'SBER'], ['BBG001DJNR51', 0.8321877926275119, 'RBCM'], ['TCS00A105BN4', 0.6218420946779809, 'GECO'], ['BBG00HY6V6H5', 1.3087184451967677, 'GTRK'], ['BBG004S68CP5', 0.34524105133319255, 'MVID'], ['BBG000GMGNB3', 0.25163839647367114, 'RBC'], ['BBG010JBYV98', 0.394801843820373, 'ZIP'], ['BBG000MZL2S9', 0.567345238002945, 'PMSBP'], ['BBG004S68DD6', 0.5092197963269613, 'MSTT'], ['BBG004S68598', 0.3887155023171196, 'MTLR'], ['BBG004S688G4', 0.13099559279519604, 'AKRN'], ['BBG004730RP0', 0.21241899304786932, 'GAZP'], ['BBG0047315Y7', 0.18160362428627952, 'SBERP'], ['BBG0063FKTD9', 0.3634822724682316, 'LENT'], ['BBG000QJW156', 0.42656447692010235, 'BSPB'], ['BBG000FVXD63', 0.3091274075563092, 'RRC'], ['BBG000LWNRP3', 0.7429491046123026, 'RKKE'], ['BBG000NLC9Z6', 0.5110984597483694, 'LSNG'], ['BBG00QKJSX05', 0.3277955015138499, 'RENI'], ['BBG000VH7TZ8', 0.3509504565206677, 'MRKC'], ['TCS00A103X66', 0.28715136290632043, 'POSI'], ['BBG000NLB2G3', 0.6149436921817565, 'KROT'], ['BBG002B9MYC1', 0.4657238176054815, 'KAZT'], ['BBG004S684M6', 0.2526110394118978, 'SIBN'], ['BBG002B298N6', 0.44769456415394243, 'YAKG'], ['BBG000Q7GG57', 0.8224804933891446, 'TGKB'], ['BBG000DBD6F6', 0.7445023267028728, 'KLSB'], ['BBG000RP8V70', 0.6478127437297219, 'CHMK'], ['BBG00F9XX7H4', 0.46071267320818055, 'RNFT'], ['BBG000TJ6F42', 0.707468016650335, 'MRKZ'], ['BBG000K3STR7', 0.42117137946912264, 'APTK'], ['BBG000DD3510', 0.2771539308180033, 'AIV'], ['BBG005D1WCQ1', 0.7447051473208933, 'QIWI'], ['BBG00475K2X9', 0.282011667678702, 'HYDR'], ['BBG004S681B4', 0.3110680394207341, 'NLMK'], ['BBG000TY1CD1', 0.24373873200783872, 'BELU'], ['BBG000SR0YS4', 0.40858083374870874, 'LNZLP'], ['BBG00CVQZQ96', 0.22454636728453595, 'ITT'], ['BBG003LYCMB1', 0.650018042653199, 'SFIN'], ['BBG000QF1Q17', 0.5159670132826827, 'FESH'], ['BBG000BGX2S0', 0.1557908764651936, 'ATR'], ['BBG004S68696', 0.3224103880240563, 'RASP'], ['BBG0100R9963', 0.33889694886834487, 'SGZH'], ['BBG000NLCCM3', 0.23419070241381942, 'LSNGP'], ['BBG000N7KBZ3', 0.6731716871518428, 'BE'], ['TCS00A0JR514', 0.4283303865172949, 'LIFE'], ['BBG000BFVZ83', 0.2620026597308728, 'RNR'], ['BBG000BNC3Y9', 0.3482603316600783, 'LNC'], ['BBG004S686W0', 0.33167934522632614, 'UPRO'], ['BBG000VJMH65', 0.7952242998730169, 'MRKS'], ['BBG004S687W8', 0.30856133912799316, 'MSNG'], ['BBG004S68614', 0.30849804061956015, 'AFKS'], ['BBG000R607Y3', 0.25401473613507075, 'PLZL'], ['BBG004731032', 0.21436608597698037, 'LKOH'], ['BBG000BTNGZ4', 0.4716669636239801, 'OMCL'], ['BBG00WCNDCZ6', 0.6332706273348223, 'AAN'], ['BBG000CZWZ05', 0.2766757035367557, 'BMRN'], ['BBG004S68BR5', 0.5380619395730908, 'NMTP'], ['BBG000QFH687', 0.3888234269014223, 'TGKA'], ['BBG0027F0Y27', 0.44105499826963934, 'CNTLP'], ['BBG004S68FR6', 0.417774067524629, 'MTLRP'], ['BBG000C7P5M7', 0.7560526500696412, 'MRKY'], ['BBG00209SZJ7', 0.7296845338368696, 'INSP'], ['BBG00XDH4NZ2', 0.7150816450426511, 'GRPH']]
